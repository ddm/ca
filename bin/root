#!/usr/bin/env sh

set -e

: ${1?Domain?}
: ${2?Country?}
: ${3?Location?}

DOMAIN=$1
COUNTRY=$2
LOCATION=$3

DAYS=${4:-365}
BITS=${5:-4096}

openssl req -subj "/C=${COUNTRY}/L=${LOCATION}/CN=${DOMAIN}" -x509 -sha256 -nodes -days ${DAYS} -newkey rsa:${BITS} -keyout /tmp/${DOMAIN}.key -out /tmp/${DOMAIN}.crt && chmod 600 /tmp/${DOMAIN}.key
openssl x509 -text -noout -in /tmp/${DOMAIN}.crt
